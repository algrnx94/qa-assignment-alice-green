<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QA Challenge Platform</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header>
        <h1>B2B SaaS Platform</h1>
    </header>
    <main>
        <section id="inventory">
            <h2>Inventory</h2>
            <table id="inventoryTable">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Name</th>
                        <th>Price</th>
                        <th>Stock</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Items will be loaded here -->
                </tbody>
            </table>
            <h3>Add New Item</h3>
            <div class="form-group">
                <label>Name</label>
                <input type="text" id="itemName">
            </div>
            <div class="form-group">
                <label>Price</label>
                <input type="number" id="itemPrice">
            </div>
            <div class="form-group">
                <label>Stock</label>
                <input type="number" id="itemStock">
            </div>
            <button onclick="addItem()">Add Item</button>
        </section>

        <section id="invoices">
            <h2>Create Invoice</h2>
            <div class="form-group">
                <label>Customer Name</label>
                <input type="text" id="customerName">
            </div>
            <div class="form-group">
                <label>Select Item</label>
                <select id="invoiceItemSelect"></select>
            </div>
            <div class="form-group">
                <label>Quantity</label>
                <input type="number" id="invoiceQty" value="1">
            </div>
            <button onclick="createInvoice()">Create Invoice</button>
            <div id="invoiceResult"></div>
        </section>

        <section id="reports">
            <h2>Reports</h2>
            <button onclick="getReport()">Generate Sales Report</button>
            <div id="reportResult"></div>
        </section>
    </main>

    <script>
        async function loadInventory() {
            const res = await fetch('/api/inventory');
            const items = await res.json();
            const tbody = document.querySelector('#inventoryTable tbody');
            const select = document.getElementById('invoiceItemSelect');
            
            tbody.innerHTML = '';
            select.innerHTML = '';
            
            items.forEach(item => {
                tbody.innerHTML += `
                    <tr>
                        <td>${item.id}</td>
                        <td>${item.name}</td>
                        <td>$${item.price}</td>
                        <td>${item.stock}</td>
                    </tr>
                `;
                
                select.innerHTML += `<option value="${item.id}">${item.name} ($${item.price})</option>`;
            });
        }

        async function addItem() {
            const name = document.getElementById('itemName').value;
            const price = document.getElementById('itemPrice').value;
            const stock = document.getElementById('itemStock').value;

            // Simple client-side check, but server allows flaws
            await fetch('/api/inventory', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json'},
                body: JSON.stringify({ name, price: Number(price), stock: Number(stock) })
            });

            document.getElementById('itemName').value = '';
            document.getElementById('itemPrice').value = '';
            document.getElementById('itemStock').value = '';
            
            loadInventory();
        }

        async function createInvoice() {
            const customerName = document.getElementById('customerName').value;
            const itemId = document.getElementById('invoiceItemSelect').value;
            const quantity = document.getElementById('invoiceQty').value;

            const res = await fetch('/api/invoices', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json'},
                body: JSON.stringify({
                    customerName,
                    items: [{ itemId, quantity: Number(quantity) }]
                })
            });

            const data = await res.json();
            document.getElementById('invoiceResult').innerHTML = `
                <p>Invoice Created!</p>
                <pre>${JSON.stringify(data, null, 2)}</pre>
            `;
            
            // Refresh inventory to see if stock changed (it won't because of the bug)
            loadInventory();
        }

        async function getReport() {
            const res = await fetch('/api/reports/sales');
            const data = await res.json();
            document.getElementById('reportResult').innerHTML = `
                <p>Total Sales (incl. bugs): $${data.totalSales.toFixed(2)}</p>
                <p>Date: ${data.timestamp}</p>
            `;
        }

        // Initial load
        loadInventory();
    </script>
</body>
</html>
